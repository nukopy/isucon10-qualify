# チェックリスト

## 前日

- [ ] ISUCON 用の `~/.ssh/config` ファイルを書いてある（後は本番の「ユーザ名」，「グローバル IP」を入れれば OK な状態）

## 当日

### 序盤：最初の 1 h

- [ ] ポータルへログイン
- [ ] サーバへログインし，サービスを起動し，最初のベンチマークを起動する
- [ ] ローカル <-> ISUCON サーバ間の SSH 接続の設定
  - [ ] VSCode Remote Development で各サーバへ繋げるようになる．
    - `cmd + shift + P` > `Remote-SSH: Connect to Host...`
      - bench
      - web1
      - web2
- [ ] ISUCON サーバ <-> GitHub 間の SSH 接続の設定
- [ ] `git init` & `git pull` でサーバ側のファイルを同期できるようにする
- サーバの確認
  - インスタンスのスペックの確認
    - `htop`
  - OS のバージョン確認
    - `grep -H "" /etc/*version ; grep -H "" /etc/*release`

ここまでで，サーバのファイルを編集する準備ができた．git pull の後に一度サーバにリポジトリのファイルがちゃんと pull できているか確認すると良い．

- サーバのセットアップ
  - [ ] 監視，計測のためのソフトウェアを導入する
    - [ ] リソースの監視：htop/dstat
    - [ ] HTTP サーバのアクセスログ：kataribe
    - [ ] SQL ログ解析：pt-query-digest
  - [ ] 計測しながらベンチマークを回し，その結果が Slack に通知される
- インフラの確認
  - [ ] システム構成の全体像を確認する
- アプリケーションの理解
  - [ ] アクセスポイントの整理（API エンドポイント）
  - [ ] ユーザが利用する流れを理解
  - [ ] データ量と流れの理解
    - [ ] テーブル名とカラム
    - [ ] データの更新がある部分のロジックを確認
- プロファイリング
  - アクセスログ解析
  - MySQL のスローログ解析
  - アプリケーションのプロファイリング
  - サーバの負荷の確認（CPU，メモリ（，ストレージ））
- プロファイリング結果を読み解く慣れも必要

#### 補足: 計測のためのソフトウェア

あらかじめ決めておく．

- リソースの監視
  - CUI: htop/dstat
  - GUI: netdata
- HTTP サーバのアクセスログ
  - alp
  - kataribe
- SQL ログ解析（RDB のスロークエリログ）
  - pt-query-digest
- APM（Application Performance Monitoring）
  - New Relic / Data Dog

### 中盤

- 計測 -> 改善のサイクルを回す

### 終盤：最後の 1 h

- **最後の 30 分は再起動テストに残す**

終了後に運営側で全ての VM を再起動し，ベンチマーカでスコアを再計測する．それが最終スコアとなる．最後の 1 h はこの再計測に備えて動く．

- 競技終了前のチェック
  - 再起動の試験をする
    - リブート後に想定している実装言語で動いているかの確認
    - MySQL のバッファプールに載せるのであればその部分も書く
    - 凡ミス例
      - `systemctl` の自動設定を変更していないため別の言語実装で動いてしまった
      - 実験的に変更した設定ファイルを戻し忘れた
  - MySQL, Nginx のログを切る
    - アクセスログ
    - スロークエリログ
  - 大きくコンフィグに触れない
  - ディスクサイズに余裕があるか。運営サイドでベンチマークを回す時にログ出力でディスクがうまることがないとも限らない。ログを吐きまくってると意外とディスクに余裕がなくなっていたりするため、最後に確認する。
  - ページの表示は正常か．CSS がなぜかあたってないとかないか．
- **(厳密には競技終了 30 分〜60 分の間ぐらい)**
  - OS ごと再起動してもベンチマークが通るかどうか
