# ISUCON10 参加記

ISUCON10 にソロ参加しました．

- チーム：HHKB は実質 0 円
- メンバー
  - nukopy

ソロ参加の理由は，本番までに取れる練習時間がほぼなかったのでチームを組んでも迷惑を掛けてしまうと思ったからです（Twitter で募集して集まるかどうかはまた別問題）．

## 準備編

半年前くらいに一度だけ練習したが，それ以降は ISUCON への準備は全くしていなかった．前日の NTT コム主催の N-ISUCON で ISUCON に入門し，当日を迎えるという流れだった．

もっと早くから対策しておくべきだと思いました．

### 前日に N-ISUCON に参加

前日の 2020/09/11 には N-ISUCON があったのでチュートリアル的に参加した．サーバへの接続，アプリケーションを動かしてベンチを動かすことしかできず，Nginx の設定をしていたら時間が終わっていた．

### N-ISUCON での反省

全体的な反省は，パフォーマンスチューニングに集中するためにそれ以外のことは全て自動化すべきだったと思った．

- 自動化すべき部分
  - コンテスト開始直後の SSH 周りの設定
  - ISUCON サーバへの必要なソフトウェアのインストール
    - Nginx, kataribe, pt-query-digest, slackcat
  - 各種設定ファイルの Git 管理
    - systemd の Unit ファイル：`/etc/systemd/system/[name].service`
    - Nginx の設定ファイル：`/etc/nginx/nginx.conf`
  - ソースコードや設定ファイルの編集を反映させるためのアプリケーション，ミドルウェアのプロセスの再起動
  - 計測や計測結果の Slack 通知
  - コミット & デプロイ
  - 全サーバのソースコードを同期する

以下，細かな反省点を上げていく．

- 反省点 1：休憩をちゃんと取る
  - 時間はいくらあっても足りないが，適度に休憩を取らないと集中力が落ちてしまう．長丁場の戦いのためそこらへんを上手くコントロールしないといけない．
- 反省点 2：ミドルウェアの設定ファイルの Git 管理
  - VSCode Remote Development だと管理者権限の問題で Nginx，MySQL の設定ファイルを編集できなかった．Vim を使えないのでサーバ側で直で編集するしかなかった．
  - というか参加者が設定ファイル類をどうやって Git で管理しているのかずっと疑問だった．コンテスト中にシンボリックリンクを貼ってみたが，管理者権限が必要なディレクトリへのシンボリックリンクの元ファイルも VSCode Remote Development では編集できなかった（これは当然）
  - **改善方法**
    - -> `/etc/nginx/nginx.conf` を直接編集するのではなく，`nginx.conf` を新規に作成し Git で管理し，Nginx 再起動時（設定を反映させる）にそのファイルを `/etc/nginx/nginx.conf` にコピーする，という方法を取った．
      - 参考：
      - コピー -> 再起動は自動化する部分

### 本番へ向けての準備

- 当日マニュアルを読む
- 環境構築，SSH 接続の設定の確認
- Nginx，MySQL，Redis などミドルウェアの設定方法の確認
  - 他の Web サーバの場合，そのサーバの見つけ方，Nginx への切り替え方を確認
    - `ps auxf | apache httpd`, `ps auxf | grep apache`，systemd のコマンドなど
- マシンスペックの確認方法
- システム構成の確認方法

---

## 本番編

N-ISUCON の反省を生かして，本番まで自動化スクリプトを必死に準備した．パフォーマンスチューニングは本番に調べながらすることにした．

### 10:00 ~
